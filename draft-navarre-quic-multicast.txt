



QUIC                                                          L. Navarre
Internet-Draft                                            O. Bonaventure
Intended status: Experimental                                  UCLouvain
Expires: 18 April 2025                                   15 October 2024


    Flexicast QUIC: combining unicast and multicast in a single QUIC
                               connection
                  draft-navarre-quic-multicast-latest

Abstract

   This document proposes Flexicast QUIC, a simple extension to
   Multipath QUIC that enables a source to send the same information to
   a set of receivers using a combination of unicast paths and multicast
   trees.

About This Document

   This note is to be removed before publishing as an RFC.

   Status information for this document may be found at
   https://datatracker.ietf.org/doc/draft-navarre-quic-multicast/.

   Discussion of this document takes place on the QUIC Working Group
   mailing list (mailto:quic@ietf.org), which is archived at
   https://mailarchive.ietf.org/arch/browse/quic/.  Subscribe at
   https://www.ietf.org/mailman/listinfo/quic/.

   Source for this draft and an issue tracker can be found at
   https://github.com/louisna/draft-navarre-quic-multicast.

Status of This Memo

   This Internet-Draft is submitted in full conformance with the
   provisions of BCP 78 and BCP 79.

   Internet-Drafts are working documents of the Internet Engineering
   Task Force (IETF).  Note that other groups may also distribute
   working documents as Internet-Drafts.  The list of current Internet-
   Drafts is at https://datatracker.ietf.org/drafts/current/.

   Internet-Drafts are draft documents valid for a maximum of six months
   and may be updated, replaced, or obsoleted by other documents at any
   time.  It is inappropriate to use Internet-Drafts as reference
   material or to cite them other than as "work in progress."

   This Internet-Draft will expire on 18 April 2025.

Copyright Notice

   Copyright (c) 2024 IETF Trust and the persons identified as the
   document authors.  All rights reserved.

   This document is subject to BCP 78 and the IETF Trust's Legal
   Provisions Relating to IETF Documents (https://trustee.ietf.org/
   license-info) in effect on the date of publication of this document.
   Please review these documents carefully, as they describe your rights
   and restrictions with respect to this document.  Code Components
   extracted from this document must include Revised BSD License text as
   described in Section 4.e of the Trust Legal Provisions and are
   provided without warranty as described in the Revised BSD License.

Table of Contents

   1.  Introduction
   2.  Conventions and Definitions
   3.  Flexicast QUIC
   4.  Handshake Negotiation and Transport parameter
   5.  New Frames
     5.1.  FC_ANNOUNCE frame
     5.2.  FC_STATE frame
       5.2.1.  FC_STATE actions
     5.3.  FC_KEY frame
       5.3.1.  FC_KEY algorithms
   6.  Security Considerations
   7.  IANA Considerations
   8.  References
     8.1.  Normative References
     8.2.  Informative References
   Acknowledgments
   Authors' Addresses

1.  Introduction

   Starting from the initially efforts of Steve Deering [RFC1112], the
   IETF has developed a range of IP multicast solutions that enable the
   efficient transmission of a single packet to a group of receivers.
   In this document, we focus on Source-Specific Multicast for IP
   [RFC4607], but the solution proposed could also be applied to other
   forms of IP Multicast.

   Although IP Multicast is not a new solution, it is not as widely used
   by applications as transport protocols like TCP [RFC9293] or QUIC
   [QUIC-TRANSPORT].  Current IP Multicast applications include IP TV
   distribution in ISP networks and trading services for financial
   institutions.  Many reasons explain the difficulty of deploying IP
   Multicast [DIOT].  From the application's viewpoint, a key challenge
   with IP Multicast is that even if there is a unicast path between two
   hosts, there is no guarantee that it will be possible to create and
   maintain a multicast tree between these two hosts to efficiently
   exchange data using IP multicast.  For this reason, many applications
   that send the same information to a large set of receivers like
   streaming services or software updates, still rely on TCP or QUIC.
   This is inefficient from the network viewpoint as the network carries
   the same information multiple times.

   The deployment of QUIC opens an interesting opportunity to reconsider
   the utilization of IP Multicast.  As QUIC runs above UDP, it could
   easily use IP multicast to deliver information along multicast trees.
   Multicast extensions to QUIC have already been proposed
   [MULTICAST-QUIC] [I-D.pardue-quic-http-mcast].

   This document proposes to start from Multipath QUIC [MULTIPATH-QUIC].
   Thanks to this recent QUIC extension, a QUIC connection can use
   several paths simultaneously to exchange information between two
   hosts.  This document proposes a simple extensions to Multipath QUIC
   that enables the utilization of an IP Multicast tree as one
   additional path.

2.  Conventions and Definitions

   The key words "MUST", "MUST NOT", "REQUIRED", "SHALL", "SHALL NOT",
   "SHOULD", "SHOULD NOT", "RECOMMENDED", "NOT RECOMMENDED", "MAY", and
   "OPTIONAL" in this document are to be interpreted as described in
   BCP 14 [RFC2119] [RFC8174] when, and only when, they appear in all
   capitals, as shown here.

3.  Flexicast QUIC

   Multipath QUIC was designed to enable the simultaneous utilization of
   multiple paths to support a single QUIC connection.  A Multipath QUIC
   connection starts with a handshake like a regular QUIC connection,
   besides the utilization of the initial_max_path_id to negotiate the
   multipath extension.  This parameter specifies the maximum path
   identifier that an endpoint is willing to maintain at connection
   Establishment.  Multipath QUIC requires the utilization of non-zero
   connection identifiers and uses explicit path identifiers and one
   packet number space per path.  Multipath QUIC assumes that the
   additional paths are created by the client using the server address
   of the initial paths.

   Consider as an example a smartphone that uses Multipath QUIC.  This
   smartphone has a Wi-Fi and a cellular interface.  The smartphone has
   created the QUIC connection over the cellular interface.  After the
   handshake, the smartphone and the server have exchanged additional
   connection identifiers.  To create a new path over the Wi-Fi
   interface, the smartphone sends a PATH_CHALLENGE over this path using
   one of the connection identifiers advertised by the server.  The
   server replies with a PATH_RESPONSE using one of the connection
   identifiers advertised by the smartphone.  The smartphone confirms
   the establishment of the second path using a PATH_RESPONSE.  At this
   point that smartphone and the server have two paths to exchange data:
   the first over the cellular interface and the second over the Wi-Fi
   interface.  Each path uses a different sequence number space, but
   QUIC packets are encrypted using the same connection keys over both
   paths.  When a QUIC packet needs to be send, the packet scheduler
   selects the relevant path.  If a QUIC frame is lost over one path, it
   can be retransmitted over the other paths.

   To illustrate the operation of Flexicast QUIC, we consider a scenario
   with one server, S, and three receivers: R1, R2 and R3.  R1 and R2
   are attached to a network where it is possible to create an IP
   multicast tree from S to R1 and R2.  R3 is attached to an IP network
   where unicast works perfectly, but IP multicast does not.  Once the
   Flexicast QUIC connection will be established, S will be able to send
   data along the multicast tree to reach R1 and R2 and using unicast to
   reach R3.  This is illustrated in the ..

     S --------------------+-----> R1
     \                     |
      \                    +-----> R2
       \
        +------------------------> R3

     Figure 1: A Flexicast QUIC connection where source S sends a data
         packet to R1 and R2 using a multicast tree and to R3 using
                                  unicast

   A Flexicast QUIC connection starts with a handshake like a regular
   QUIC connection.  R1, R2 and R3 establish a connection to S using the
   flexicast and the initial_max_path_id transport parameters.  These
   three QUIC connections are glued as a single Flexicast QUIC
   connection by the server.  They are secured using the TLS keys
   derived independently during the handshake.  The first path of these
   connections serves as a unicast path for the Flexicast QUIC
   connection between the server and each receiver.  This path is used
   for two very different purposes.  First, it acts as a control channel
   and enables the source to exchange control information with each
   receiver.  Second, it can be used to transmit or retransmit data that
   cannot be delivered along the multicast tree.

     +========================================+.    / \
     |+=================================+     |.     |. unicast paths
     || ============================+   |     |.     |
     \|/                            |   |     |.    \./
      S --------------------+-----> R1  |.    |.    / \
                            |           |.    |.     |
                            +---------> R2.   |.     |  multicast tree
                                              |.     |
                                              R3.   \ /

     Figure 2: A Flexicast QUIC connection is composed of two types of
      paths: (1) one unicast path between the source and each receiver
       and (2) a multicast tree from the source to a set of receivers

   Flexicast QUIC modifies Multipath QUIC is several ways to enable the
   utilization of a multicast tree as one of the Multipath QUIC paths.
   Using an IP Multicast tree as a Multipath QUIC path on a connection
   brings several challenges.

   1.  An IP multicast tree is unidirectional, in contrast with a
       Multipath QUIC path

   2.  An IP multicast tree is identified by a pair <source address,
       group address>

   3.  All the receivers attached to an IP Multicast tree receive the
       same packet

   Since an IP multicast tree is unidirectional, it is impossible to use
   the QUIC path challenge/response mechanism to create a path along an
   IP multicast tree.  Flexicast QUIC only uses path challenge/response
   on unicast paths.  Furthermore, the data received over the multicast
   path cannot be acknowledged over this path since it is
   unidirectional.  Flexicast QUIC receivers return acknowledgments
   using MP_ACK frames over the unicast path to provide feedback to the
   server.

   To join an IP multicast tree, the receivers must be informed of the
   source and group addresses of this tree.  The server uses the
   MC_ANNOUNCE frame to advertise the identifier of the multicast tree
   that the receivers can join.

   The Flexicast QUIC packets that are sent over an IP multicast tree
   must be encrypted and authenticated.  However, these packets cannot
   be encrypted using the TLS keys derived during the QUIC connection
   establishment since each unicast path has its own set of TLS keys.
   To secure the transmission of Flexicast QUIC packets along an IP
   multicast tree, the source generates an independent set of security
   keys and shares them using the MC_ANNOUNCE frame to all receivers
   over the unicast path.  Since this frame is sent over the unicast
   paths, it is authenticated and encrypted using the TLS keys
   associated to each unicast path.

4.  Handshake Negotiation and Transport parameter

   This extension defines a new transport parameter, used to negotiate
   the use of the flexicast extensiong during the connection handshake,
   as specified in [QUIC-TRANSPORT].  The new transport parameter is
   defined as follows:

   *  flexicast_support (current version uses TDB-03): the presence of
      this transport parameter indicates support of the flexicast
      extension.  The transport parameter contains two boolean values,
      respectively indicating support of IPv4 and IPv6 for multicast
      addresses.  If an endpoint receives the flexicast_support
      transport parameter with both IPv4 and IPv6 supports set to false
      (0), it must close the connection with an error type of
      FC_PROTOCOL_VIOLATION.

   The final support of the flexicast extension is conditioned to the
   support of the multipath extension, as defined in [MULTIPATH-QUIC].
   Since a Flexicast flow is a new multipath path, the support of
   multipath, with sufficient (e.g., at least 2) path ID, is required,
   as defined in Section 2 of [MULTIPATH-QUIC].

   An endpoint receiving the flexicast_support transport parameter from
   its peer, without support for multicast MUST ignore the
   flexicast_support transport parameter, as if the peer does not
   support the flexicast extension.

   The extension does not change the definition of any transport
   parameter defined in Section 18.2 of [QUIC-TRANSPORT].

5.  New Frames

   All frames defined in this document MUST only be sent in 1-RTT
   packets.

   If an endpoint receives a flexicast-specific frame in a different
   packet type, it MUST close the connection with an error of type
   FRAME_ENCODING_ERROR.

   Receipt of flexicast-specific frames related to a Flexicast Flow ID
   that is not added by an endpoint MUST be treated as a connection
   error of type FC_PROTOCOL_VIOLATION.

   If an endpoint receives a flexicast-specific frame with a Flexicast
   Flow ID that it cannot process anymore (e.g., the flexicast flow
   might have been abandoned), it MUST silently ignore the frame.

   The new frames introduced below are for control-specific purpose
   only, and MUST NOT be sent on the Flexicast flow.  Receipt of any of
   the following frames on the Flexicast flow MUST be trated as a
   connection error of type FC_PROTOCOL_VIOLATION.

5.1.  FC_ANNOUNCE frame

   The FC_ANNOUNCE frame informs the receiver that a Flexicast flow is
   available or updated.  FC_ANNOUNCE frames MUST NOT be sent by the
   receiver.  A Flexicast QUIC source receiving an FC_ANNOUNCE frame
   MUST close the connection with a connection error of type
   FC_PROTOCOL_VIOLATION.

   FC_ANNOUNCE frames are formatted as shown in Figure 3.

   FC_ANNOUNCE Frame {
       Type (i) = TBD-00,
       Length (8),
       Flexicast Flow ID (8..160),
       Sequence number (i),
       IP Version (8),
       Source IP (32, 128),
       Group IP (32, 128),
       UDP Port (16),
       Ack delay timer (64),
   }

                     Figure 3: FC_ANNOUNCE Frame Format

   FC_ANNOUNCE frames contain the following fields:

   Length: An 8-bit unsigned internet containing the length of the
   Flexicast Flow ID.  Values less than 1 and greated than 20 are
   invalid and MUST be treated as a connection error of type
   FRAME_ENCODING_ERROR.

   Flexicast Flow ID: A Flexicast Flow ID of the specified length.

   Sequence number: The monotically increasing sequence number related
   to the advertised Flexicast Flow ID.

   IP Version: An 8-bit unsigned integer containing the version of IP
   used to advertise the Source IP and Group IP.  Values different than
   4 (for IPv4) and 6 (IPv6) are invalid and MUST be treated as a
   conneciton error of type FRAME_ENCODING_ERROR.

   Source IP: The IP address of the multicast source.

   Group IP: The IP address of the multicast group.  The address MUST be
   a multicast address.

   UDP Port: The UDP destination port.

   Ack delay timer: A 64-bit unsigned integer containing the delay, in
   ms, between two acknowledgments from a receiver.

   FC_ANNOUNCE frames are ack-eliciting.  If a packet containing an
   FC_ANNOUNCE frame is considered lost, the peer SHOULD repeat it.

   Sources are allowed to send multiple times FC_ANNOUNCE frames with an
   increasing sequence number for the same Flexicast Flow ID.  New
   FC_ANNOUNCE frames MAY contain updated information, e.g., a new Ack
   delay timer.

   Sources are allowed to advertise multiple Flexicast flows by sending
   multiple parallel FC_ANNOUNCE frames with distinct Flexicast Flow
   IDs.  The Sequence number is linked to a specific Flexicast Flow ID.
   The same Sequence number can be used for two distinct Flexicast Flow
   IDs.

   TODO: the frame should also contain a Status field to indicate if the
   flexicast flow is retired?

5.2.  FC_STATE frame

   The FC_STATE frame informs the endpoint of the state of the Flexicast
   receiver in the Flexicast flow.  FC_STATE frames MAY be sent by both
   endpoints (i.e., receiver and source).

   FC_STATE frames are formatted as shown in Figure 4.

   FC_STATE frame {
       Type (i) = TDB-01,
       Length (8),
       Flexicast Flow ID (8..160),
       Sequence number (i),
       Action (u64),
   }

                      Figure 4: FC_STATE Frame Format

   FC_STATE frames contain the following fields:

   Length: An 8-bit unsigned internet containing the length of the
   Flexicast Flow ID.  Values less than 1 and greated than 20 are
   invalid and MUST be treated as a connection error of type
   FRAME_ENCODING_ERROR.

   Flexicast Flow ID: The Flexicast Flow ID of the Flexicast flow that
   this frame relates to.

   Sequence number: The monotically increasing sequence number related
   to the advertised Flexicast Flow ID.

   Action: The bit-encoded action, defined in Section Section 5.2.1.

   FC_STATE frames are ack-eliciting.  If a packet containing an
   FC_STATE frame is considered lost, the peer SHOULD repeat it.

   For a same Flexicast flow (i.e., identical Flexicast Flow ID), both
   endpoints use their own Sequence number.

   A receiver sending an FC_STATE frame indicates the source its status
   regarding the Flexicast flow indicated by the Flexicast Flow ID.  The
   source MAY also send FC_STATE frames to a receiver to unilaterally
   change the status of the receiver within the Flexicast flow indicated
   by the Flexicast Flow ID.

5.2.1.  FC_STATE actions

   This section lists the defined Actions encoded in an FC_STATE frame.
   An endpoint receiving an unknown value MUST treat it as a connection
   error of type FC_PROTOCOL_VIOLATION.

   The three following actions are receiver-specific.  These actions
   MUST NOT be sent inside an FC_STATE frame sent by the source.  A
   receiver receiving an FC_STATE frame with any of the following
   actions MUST treat it as a connection error of type
   FC_PROTOCOL_VIOLATION.

   JOIN (0x01): The receiver joins the Flexicast flow.

   LEAVE (0x02): The receiver leaves the Flexicast flow.

   READY (0x03): The receiver is ready to receive content on the
   Flexicast flow.

   The following action is source-specific.  This action MUST NOT be
   sent inside an FC_STATE frame sent by the receiver.  A source
   receiving an FC_STATE frame with the following action MUST treat it
   as a connection error of type FC_PROTOCOL_VIOLATION.

   MUST_LEAVE (0x04): The source unilaterally decides that the receiver
   MUST leave the Flexicast flow.

5.3.  FC_KEY frame

   The FC_KEY frame informs a receiver with the decryption key of a
   Flexicast flow joined by the receiver.  FC_KEY frames MUST NOT be
   sent by the receiver.  A Flexicast QUIC source receiving an FC_KEY
   frame MUST clone the connection with a connection error of type
   FC_PROTOCOL_VIOLATION.

   FC_KEY frames are formatted as shown in Figure 5.

   FC_KEY Frame {
       Type (i) = TDB-02,
       Length(8),
       Flexicast Flow ID(8..160),
       Sequence number (i),
       Key length (i),
       Key (..),
       Algorithm (64),
   }

                       Figure 5: FC_KEY Frame Format

   FC_KEY frames contain the following fields:

   Length: An 8-bit unsigned internet containing the length of the
   Flexicast Flow ID.  Values less than 1 and greated than 20 are
   invalid and MUST be treated as a connection error of type
   FRAME_ENCODING_ERROR.

   Flexicast Flow ID: The Flexicast Flow ID of the Flexicast flow that
   this frame relates to.

   Sequence number: The monotically increasing sequence number related
   to the advertised Flexicast Flow ID.

   Key length: A var-int indicating the length of the decryption key.

   Key: Byte-sequence of the decryption key of the Flexicast flow.

   Algorithm: The bit-encoded algorithm used for decryption, defined in
   Section Section 5.3.1.

   FC_KEY frames are ack-eliciting.  If a packet containing an FC_STATE
   frame is considered lost, the peer SHOULD repeat it.

   The source MAY send new FC_KEY frames with an increased sequence
   number to notify a new decryption key.  This mechanism can be used to
   provide backward and forward secrecy with dynamic Flexicast groups.

5.3.1.  FC_KEY algorithms

   TODO: define the bit-encoded algorithms.

6.  Security Considerations

   TODO Security

7.  IANA Considerations

   This document has no IANA actions.

8.  References

8.1.  Normative References

   [QUIC-TRANSPORT]
              Iyengar, J., Ed. and M. Thomson, Ed., "QUIC: A UDP-Based
              Multiplexed and Secure Transport", RFC 9000,
              DOI 10.17487/RFC9000, May 2021,
              <https://www.rfc-editor.org/rfc/rfc9000>.

   [RFC2119]  Bradner, S., "Key words for use in RFCs to Indicate
              Requirement Levels", BCP 14, RFC 2119,
              DOI 10.17487/RFC2119, March 1997,
              <https://www.rfc-editor.org/rfc/rfc2119>.

   [RFC8174]  Leiba, B., "Ambiguity of Uppercase vs Lowercase in RFC
              2119 Key Words", BCP 14, RFC 8174, DOI 10.17487/RFC8174,
              May 2017, <https://www.rfc-editor.org/rfc/rfc8174>.

8.2.  Informative References

   [DIOT]     Diot, C., Levine, B., Lyles, B., Kassem, H., and D.
              Belensiefen, "Deployment issues for the IP multicast
              service and architecture", IEEE network, vol. 14, no 1, p.
              78-88. , 2000.

   [I-D.pardue-quic-http-mcast]
              Pardue, L., Bradbury, R., and S. Hurst, "Hypertext
              Transfer Protocol (HTTP) over multicast QUIC", Work in
              Progress, Internet-Draft, draft-pardue-quic-http-mcast-11,
              4 July 2022, <https://datatracker.ietf.org/doc/html/draft-
              pardue-quic-http-mcast-11>.

   [MULTICAST-QUIC]
              Holland, J., Pardue, L., and M. Franke, "Multicast
              Extension for QUIC", Work in Progress, Internet-Draft,
              draft-jholland-quic-multicast-05, 7 July 2024,
              <https://datatracker.ietf.org/doc/html/draft-jholland-
              quic-multicast-05>.

   [MULTIPATH-QUIC]
              Liu, Y., Ma, Y., De Coninck, Q., Bonaventure, O., Huitema,
              C., and M. Kühlewind, "Multipath Extension for QUIC", Work
              in Progress, Internet-Draft, draft-ietf-quic-multipath-10,
              8 July 2024, <https://datatracker.ietf.org/doc/html/draft-
              ietf-quic-multipath-10>.

   [RFC1112]  Deering, S., "Host extensions for IP multicasting", STD 5,
              RFC 1112, DOI 10.17487/RFC1112, August 1989,
              <https://www.rfc-editor.org/rfc/rfc1112>.

   [RFC4607]  Holbrook, H. and B. Cain, "Source-Specific Multicast for
              IP", RFC 4607, DOI 10.17487/RFC4607, August 2006,
              <https://www.rfc-editor.org/rfc/rfc4607>.

   [RFC9293]  Eddy, W., Ed., "Transmission Control Protocol (TCP)",
              STD 7, RFC 9293, DOI 10.17487/RFC9293, August 2022,
              <https://www.rfc-editor.org/rfc/rfc9293>.

Acknowledgments

   TODO acknowledge.

Authors' Addresses

   Louis Navarre
   UCLouvain
   Email: louis.navarre@uclouvain.be


   Olivier Bonaventure
   UCLouvain
   Email: olivier.bonaventure@uclouvain.be
